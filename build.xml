<?xml version="1.0" encoding="UTF-8"?>
<!-- You may freely edit this file. See harness/README in the NetBeans platform -->
<!-- for some information on what you could do (e.g. targets to override). -->
<!-- If you delete this file and reopen the project it will be recreated. -->
<project name="javafx" basedir="." default="build">
    <description>Builds the module suite javafx.</description>
    <import file="nbproject/build-impl.xml"/>
    

    <target name="files-init" depends="-release.files">
        <property name="release.files" value=""/>
        <property name="build.config" value="daily"/>
        <property file="build-${build.config}.properties"/>
        <property environment="env"/>
        <condition property="catalog.base.url" value="${env.HUDSON_URL}job/${env.JOB_NAME}/${env.BUILD_NUMBER}/artifact/build/updates">
            <isset property="env.HUDSON_URL"/>
        </condition>
        
        <delete dir="build"/>
        <mkdir dir="build"/>
        <property name="use.timestamp" value="true"/>
        <parallel failonany="true">
            <sequential>
                <get src="${netbeans.binaries.url}" dest="netbeans.zip" usetimestamp="${use.timestamp}" verbose="true"/>
                <unzip src="netbeans.zip" dest="build"/>
            </sequential>
            <sequential>
                <mkdir dir="javafx.sdk.win/external"/>
                <get src="${javafx-sdk.win.url}" dest="javafx.sdk.win/external/javafx_sdk-windows.zip" usetimestamp="${use.timestamp}" verbose="true"/>
            </sequential>   
            <sequential>
                <mkdir dir="javafx.sdk.mac/external"/>
                <get src="${javafx-sdk.mac.url}" dest="javafx.sdk.mac/external/javafx_sdk-macosx.zip" usetimestamp="${use.timestamp}" verbose="true"/>
            </sequential>   
            <sequential>
                <mkdir dir="javafx.sdk.lin/external"/>
                <get src="${javafx-sdk.lin.url}" dest="javafx.sdk.lin/external/javafx_sdk-linux.zip" usetimestamp="${use.timestamp}" verbose="true"/>
            </sequential>   
<!--
            <sequential>
                <mkdir dir="javafx.sdk.sol/external"/>
                <get src="${javafx-sdk.sol.url}" dest="javafx.sdk.sol/external/javafx_sdk-solaris.zip"/>
            </sequential>
-->               
            <sequential>
                <mkdir dir="javafx.fxd/external"/>
                <get src="${javafx-fxd-netbeans-support.zip.url}" dest="javafx.fxd/external/javafx-fxd-netbeans-support.zip" usetimestamp="${use.timestamp}" verbose="true"/> 
            </sequential>   
        </parallel>    
    </target>
    
    <target name="clean" depends="-init,testuserdir-delete" description="Clean everything.">
        <mkdir dir="build/netbeans"/>
        <subant target="clean" buildpath="${modules.sorted}" inheritrefs="false" inheritall="false"/>
        <delete dir="${dist.dir}"/>
        <delete failonerror="false" includeemptydirs="true">
            <fileset dir="build">
                <exclude name="testuserdir/"/>
            </fileset>
        </delete>
    </target>
    
    <target name="zip-clusters" depends="nbms">
        <property name="javafx.sdk.pattern" value="javafx-sdk/**"/>
        <property name="javafx.cluster.dir" location="build/netbeans/javafx2"/>
        <property name="zips.dir" location="build/zips"/>
        <mkdir dir="${zips.dir}"/>
        <zip destfile="${zips.dir}/javafx-cluster-win.zip" update="false" duplicate="preserve">
            <zipfileset prefix="javafx2" dir="${javafx.cluster.dir}">
                <exclude name="${javafx.sdk.pattern}"/>
                <exclude name="**/*-lin.*"/>
                <exclude name="**/*-sol.*"/>
                <exclude name="**/*-mac.*"/>
            </zipfileset>
        </zip>
        <zip destfile="${zips.dir}/javafx-cluster-mac.zip" update="false" duplicate="preserve">
            <zipfileset prefix="javafx2" dir="${javafx.cluster.dir}">
                <exclude name="${javafx.sdk.pattern}"/>
                <exclude name="**/*-lin.*"/>
                <exclude name="**/*-sol.*"/>
                <exclude name="**/*-win.*"/>
          </zipfileset>
        </zip>
        <zip destfile="${zips.dir}/javafx-cluster-lin.zip" update="false" duplicate="preserve">
            <zipfileset prefix="javafx2" dir="${javafx.cluster.dir}">
                <exclude name="${javafx.sdk.pattern}"/>
                <exclude name="**/*-mac.*"/>
                <exclude name="**/*-sol.*"/>
                <exclude name="**/*-win.*"/>
          </zipfileset>
        </zip>
<!--        
        <zip destfile="${zips.dir}/javafx-cluster-sol.zip" update="false" duplicate="preserve">
            <zipfileset prefix="javafx2" dir="${javafx.cluster.dir}">
                <exclude name="${javafx.sdk.pattern}"/>
                <exclude name="**/*-lin.*"/>
                <exclude name="**/*-mac.*"/>
                <exclude name="**/*-win.*"/>
            </zipfileset>
        </zip>
-->        
        <zip destfile="${zips.dir}/javafx-sdk-win.zip" basedir="javafx.sdk.win/release" update="false" duplicate="preserve"/>
        <zip destfile="${zips.dir}/javafx-sdk-mac.zip" update="false" duplicate="preserve">
            <zipfileset dir="javafx.sdk.mac/release" filemode="755">
                <include name="javafx-sdk/bin/*"/>
            </zipfileset>
            <zipfileset dir="javafx.sdk.mac/release">
                <exclude name="javafx-sdk/bin/*"/>
            </zipfileset>
        </zip>
        <zip destfile="${zips.dir}/javafx-sdk-lin.zip" update="false" duplicate="preserve">
            <zipfileset dir="javafx.sdk.lin/release" filemode="755">
                <include name="javafx-sdk/bin/*"/>
            </zipfileset>
            <zipfileset dir="javafx.sdk.lin/release">
                <exclude name="javafx-sdk/bin/*"/>
            </zipfileset>
        </zip>
<!--        
        <zip destfile="${zips.dir}/javafx-sdk-sol.zip" update="false" duplicate="preserve">
            <zipfileset dir="javafx.sdk.sol/release" filemode="755">
                <include name="javafx-sdk/bin/*"/>
            </zipfileset>
            <zipfileset dir="javafx.sdk.sol/release">
                <exclude name="javafx-sdk/bin/*"/>
            </zipfileset>
        </zip>
-->        
    </target>

</project>
